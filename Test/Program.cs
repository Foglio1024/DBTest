using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using System.Xml.Linq;
using TCTSniffer;

namespace Test
{
    public enum EventType
    {
        Field = 3,
        Dungeon = 4,
        BattleField = 5
    }
    public enum QuestType
    {
        daily
    }
    public enum CompensationType
    {
        item,
        money,
        exp,
        reputationPoint
    }
    public class Event
    {
        public int id { get; }
        public EventType type { get; }
        public bool active { get; }
        public int categoryId { get; }
        public int questGroupId { get; }
        public int questNumId { get; }
        public bool repeat { get; }
        public int requiredItemLevel { get; }

        public Event(string _id, string _type, string _active, string catId, string qId, string rep, string ilvl)
        {
            int var;
            Int32.TryParse(_id, out var);
            id = var;
            type = (EventType)System.Enum.Parse(typeof(EventType), _type);
            active = Boolean.Parse(_active);
            Int32.TryParse(catId, out var);
            categoryId = var;
            Int32.TryParse(qId.Substring(0,4), out var);
            questGroupId = var;
            Int32.TryParse(qId.Substring(4), out var);
            questNumId = var;
            repeat = Boolean.Parse(rep);
            Int32.TryParse(ilvl, out var);
            requiredItemLevel = var;
        }
        public Event() { }
    }
    public class Quest
    {
        public int id { get; }
        public int nameId { get; }
        public QuestType type { get; }
        public int minLevel { get; }
        public int groupId { get; }
        public int realHuntingZone { get; }
        public int suitableLevel { get; }

        public Quest(string _id, string _name, string _type, string minL, string gId, string rHZ, string suitL)
        {
            int var;

            Int32.TryParse(_id, out var);
            id = var;

            type = (QuestType)System.Enum.Parse(typeof(QuestType), _type);

            string _nameid = _name.Replace("@DailyPlayGuideQuest:", "");
            Int32.TryParse(_nameid, out var);
            nameId = var;

            Int32.TryParse(minL, out var);
            minLevel = var;

            Int32.TryParse(gId, out var);
            groupId = var;

            Int32.TryParse(rHZ, out var);
            realHuntingZone = var;

            Int32.TryParse(suitL, out var);
            suitableLevel = var;
        }
        public Quest()
        {

        }
    }
    public class Compensation
    {
        private int amount;
        public CompensationType Type { get; }
        public int TemplateId { get; }
        public int Amount { get { return amount; }
            private set
            {
                if (Type == CompensationType.reputationPoint)
                {
                    amount = value * 2;
                }
                else amount = value;
            }
        }

        public string GetName()
        {
            string name = "-";
            foreach (var doc in Program.ItemStrSheet)
            {
                XElement xe = FindNameElement(doc);
                if (xe != null)
                    {
                        name = xe.Attribute("string").Value;
                    }             
            }
            return name;
        }

        private XElement FindNameElement(XDocument d)
        {
            XElement xe = d.Descendants().Where(x => x.Name == "String").Where(x => x.Attribute("id").Value == TemplateId.ToString()).FirstOrDefault();
            return xe;
        }



        public Compensation(string type, string templ, string amnt)
        {
            int var;

            Type = (CompensationType)System.Enum.Parse(typeof(CompensationType), type);

            Int32.TryParse(templ, out var);
            TemplateId = var;

            Int32.TryParse(amnt, out var);
            Amount = var;
        }
    }
    public class DailyQuest
    {
        public Event Event { get; }
        public Quest Quest { get; }
        public string Name
        {
            get
            {
                XElement questNameElement = Program.StrSheet_DailyPlayGuideQuest.Descendants().Where(x => x.Name == "String").Where(x => x.Attribute("id").Value == Quest.nameId.ToString()).FirstOrDefault();
                if (questNameElement != null)
                {
                    return questNameElement.Attribute("string").Value;
                }
                else return "";
            }
        }
        public List<Compensation> CompensationList { get; set; }
        public DailyQuest(Event ev, Quest q)
        {
            Event = ev;
            Quest = q;
            CompensationList = new List<Compensation>();
        }
    }
    public enum ItemRarity
    {
        Common,
        Uncommon,
        Rare,
        Superior
    }
    public class Item
    {
        public int Id { get;  }
        public string Name { get;  }
        public string ToolTip { get;  }
        public ItemRarity Rarity { get; set; }
        public Item(int i, string n, string t, string r)
        {
            Id = i;
            Name = n;
            ToolTip = t;
            int intr;
            Int32.TryParse(r, out intr);
            Rarity = (ItemRarity)intr;
        }
        
    }
    public class Program
    {
        public static List<Item> ItemList = new List<Item>();
        public static void LoadItemsDB()
        {
            int itemCount = 0;
            int j = 0;
            while (File.Exists("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\StrSheet_Item/StrSheet_Item-" + j + ".xml"))
            {
                var doc = new XDocument();
                doc = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\StrSheet_Item/StrSheet_Item-" + j + ".xml");
                ItemStrSheet.Add(doc);
                j++;
            }
            int k = 0;
            while (File.Exists("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\TeraDataTools-master\\TeraDataTools-master\\release\\xml\\ItemData\\ItemData-" + k + ".xml")) 
            {
                var doc = new XDocument();
                Console.Write("\rLoading ItemData-"+k+"");
                doc = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\TeraDataTools-master\\TeraDataTools-master\\release\\xml\\ItemData\\ItemData-" + k + ".xml");
                Console.Write("\rItemData-"+k+" loaded.");
                ItemData.Add(doc);
                itemCount += doc.Descendants().Count();

                k++;
            }
            int c = 0;
            double percent = 0;
            foreach (var itDoc in ItemStrSheet)
            {

                foreach (var item in itDoc.Descendants().Where( x => x.Name == "String"))
                {
                    int id = 0;
                    Int32.TryParse(item.Attribute("id").Value, out id);
                    string tt = "";
                    if(item.Attribute("toolTip") != null)
                    {
                        tt = item.Attribute("toolTip").Value;
                    }
                    ItemList.Add(new Item(id, item.Attribute("string").Value, tt, "0"));
                    percent = ((double)c / (double)itemCount) * 100;
                    Console.Write("\rLoading items: ({0}/{1} - {2}%)", c, itemCount, (int)percent);
                    c++;
                }
            }
            int i = 0;
            percent = 0;
            foreach (var itData in ItemData)
            {       
                foreach (var item in itData.Descendants().Where(x => x.Name == "Item"))
                {
                    int rarityInt;
                    Int32.TryParse(item.Attribute("rareGrade").Value, out rarityInt);
                    ItemList[i].Rarity = (ItemRarity)rarityInt;
                    percent = (double)i / (double)itemCount * 100;
                    Console.Write("\rSetting rarity... ({0}/{1} - {2}%)        ", i, itemCount, (int)percent);
                    i++;
                }
            }

        }
        public static XDocument EventMatching = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\EventMatching.xml");
        public static XDocument DailyPlayGuideQuest = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\DailyPlayGuideQuest.xml");
        public static XDocument StrSheet_DailyPlayGuideQuest = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\StrSheet_DailyPlayGuideQuest.xml");
        public static List<XDocument> ItemStrSheet = new List<XDocument>();
        public static List<XDocument> ItemData = new List<XDocument>();
        public static List<DailyQuest> RetrieveQuests(EventType t, int minLevel)
        {
            List<DailyQuest> Quests = new List<DailyQuest>();

            foreach (XElement eventgroup in EventMatching.Descendants().Where(x => x.Name == "EventGroup").Where(x => x.Attribute("isSpecialCompensation").Value == "True"))
            {
                foreach (var @event in eventgroup.Descendants().Where(x => x.Name == "Event"))
                {

                    Event ev = new Event(@event.Attribute("id").Value,
                                         @event.Attribute("type").Value,
                                         @event.Attribute("active").Value,
                                         @event.Attribute("categoryId").Value,
                                         @event.Attribute("questId").Value,
                                         @event.Attribute("repeat").Value,
                                         @event.Attribute("requiredItemLevel").Value);

                    if (ev != null)
                    {

                        XElement dailyElement = Program.DailyPlayGuideQuest.Descendants().Where(x => x.Name == "Quest").Where(x => x.Attribute("groupId").Value == ev.questGroupId.ToString()).Where(x => x.Attribute("id").Value == ev.questNumId.ToString()).FirstOrDefault();
                        if (dailyElement != null)
                        {
                            Quest q = new Quest(dailyElement.Attribute("id").Value,
                                          dailyElement.Attribute("name").Value,
                                          dailyElement.Attribute("type").Value,
                                          dailyElement.Attribute("minLevel").Value,
                                          dailyElement.Attribute("groupId").Value,
                                          dailyElement.Attribute("realHuntingZoneId").Value,
                                          dailyElement.Attribute("suitableLevel").Value);
                            DailyQuest dq = new DailyQuest(ev, q);


                            foreach (var item in @event.Descendants().Where(x => x.Name == "Compensation"))
                            {
                                dq.CompensationList.Add(new Compensation(item.Attribute("type").Value, item.Attribute("templateId").Value, item.Attribute("amount").Value));
                            }

                            if (dq.Quest.suitableLevel >= minLevel && dq.Event.type == t)
                            {
                                Quests.Add(dq);
                            }
                        }
                    }
                }
            }
            return Quests;
        }
    
    static void Main()
        {
            //LoadItemsDB();
            //RetrieveQuests(EventType.Dungeon);
            //RetrieveQuests(EventType.Field);
            //RetrieveQuests(EventType.BattleField);
            //foreach (var dq in Quests)
            //{
            //    Console.WriteLine(" {0} - {1}", dq.Event.requiredItemLevel, dq.Name);
            //    foreach (var item in dq.CompensationList)
            //    {
            //        switch (item.Type)
            //        {
            //            case CompensationType.item:
            //                break;
            //            case CompensationType.money:
            //                Console.ForegroundColor = ConsoleColor.Yellow;
            //                break;
            //            case CompensationType.exp:
            //                Console.ForegroundColor = ConsoleColor.Cyan;
            //                break;
            //            case CompensationType.reputationPoint:
            //                Console.ForegroundColor = ConsoleColor.Magenta;
            //                break;
            //            default:
            //                break;
            //        }
            //        Console.WriteLine("\t {0} ({1})", item.Name, item.Amount);
            //        Console.ResetColor();
            //    }
            //    Console.WriteLine();
            //}
        }
    }
}

//static bool ccbEnding = false;

//class Tst
//{
//    async Task WaitCancel()
//    {
//        await Task.Delay(2000);
//    }
//    public void StartCcbDeletion()
//    {
//        Console.WriteLine("Started ccb cancel");
//        ccbEnding = true;
//        var tm = new System.Timers.Timer(2000);
//        tm.AutoReset = false;
//        tm.Elapsed += (a, b) =>
//        {
//            if (ccbEnding)
//            {
//                Console.WriteLine("CCB ended");
//            }
//        };
//        tm.Enabled = true;

//    }



//}
//static void Main(string[] args)
//{
//    var t = new Tst();

//    t.StartCcbDeletion();
//    Console.WriteLine("returned");
//    Console.ReadLine();
//}

//class Program
//{
//    public static XDocument SS_ZoneName = new XDocument();

//    static void Main()
//    {
//        SS_ZoneName = XDocument.Load("C:\\Users\\Vincenzo1\\Desktop\\Progetti VS\\Tera Character Tracker\\TCTMain\\content\\tera_database\\StrSheet_ZoneName.xml");
//        var guildQuestListParser = new GuildQuestListParser();
//        guildQuestListParser.ParseGuildListPacket("2025D15E290084004C00700038410000F34C000001000000000000000000000064000000000000000000000000000000530000003000000001000000FD6B1E520000000000000000050000005200650073007000690072006F002000440065006C00200044007200610067006F00000046006F0067006C0069006500740074006100000084006401010030010000000002004401BC00E4000C01D1070000040000000000000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003100300030003100000040004700750069006C006400510075006500730074003A00320030003000310030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000030010000000000001A000000000000000300000044015401002D3101A00000000000000054010000012D31015200000000000000640144020100100200000000020024029C01C401EC01D2070000040000000100000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003200300030003100000040004700750069006C006400510075006500730074003A00320030003000320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000010020000000000001A000000000000000900000024023402002D3101E00100000000000034020000012D31016100000000000000440224030100F00200000000020004037C02A402CC02D3070000040000000200000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003300300030003100000040004700750069006C006400510075006500730074003A00320030003000330030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000F0020000000000001A000000000000000F00000004031403002D3101200300000000000014030000012D31016F00000000000000240304040100D003000000000200E4035C038403AC03D4070000040000000000000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003400300030003100000040004700750069006C006400510075006500730074003A00320030003000340030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000D0030000000000000A0000000000000003000000E403F403002D31018C00000000000000F4030000012D31014F000000000000000404E4040100B004000000000200C4043C0464048C04D5070000040000000100000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003500300030003100000040004700750069006C006400510075006500730074003A00320030003000350030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000B0040000000000000A0000000000000009000000C404D404002D3101A401000000000000D4040000012D31015D00000000000000E404C40501009005000000000200A4051C0544056C05D6070000040000000200000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003600300030003100000040004700750069006C006400510075006500730074003A00320030003000360030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000090050000000000000A000000000000000F000000A405B405002D3101BC02000000000000B4050000012D31016A00000000000000C405A406010070060000000002008406FC0524064C06D7070000040000000000000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003700300030003100000040004700750069006C006400510075006500730074003A00320030003000370030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000700600000000000046000000000000000300000084069406002D3101780000000000000094060000012D31014B00000000000000A4068407010050070000000002006407DC0604072C07D8070000040000000100000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003800300030003100000040004700750069006C006400510075006500730074003A00320030003000380030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000500700000000000046000000000000000900000064077407002D3101680100000000000074070000012D3101580000000000000084076408010030080000000002004408BC07E4070C08D9070000040000000200000000D002000000000000C0A8000002000000020000000040004700750069006C006400510075006500730074003A003200300030003900300030003100000040004700750069006C006400510075006500730074003A00320030003000390030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000300800000000000046000000000000000F00000044085408002D3101580200000000000054080000012D3101640000000000000064086C09030010090000000002004C099C08C408EC08B90B0000020000000000000000D002000000000000C0A8000003000000030000000040004700750069006C006400510075006500730074003A003300300030003100300030003100000040004700750069006C006400510075006500730074003A00330030003000310030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000001009240900000000A406000000000000A00000002409380900000000A506000000000000A00000003809000000000000A606000000000000A00000004C095C09002D31018C000000000000005C090000012D31014F000000000000006C09740A0300180A000000000200540AA409CC09F409BA0B0000020000000100000000D002000000000000C0A8000003000000030000000040004700750069006C006400510075006500730074003A003300300030003200300030003100000040004700750069006C006400510075006500730074003A00330030003000320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000180A2C0A00000000A406000000000000E00100002C0A400A00000000A506000000000000E0010000400A000000000000A606000000000000E0010000540A640A002D3101E001000000000000640A0000012D31016100000000000000740A540B0100200B000000000200340BAC0AD40AFC0ABB0B0000020000000000000000D002000000000000C0A8000003000000030000000040004700750069006C006400510075006500730074003A003300300030003300300030003100000040004700750069006C006400510075006500730074003A00330030003000330030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000200B000000000000A406000000000000E0010000340B440B002D31018C00000000000000440B0000012D31014F00000000000000540B340C0100000C000000000200140C8C0BB40BDC0BBC0B0000020000000000000000D002000000000000C0A8000003000000030000000040004700750069006C006400510075006500730074003A003300300030003400300030003100000040004700750069006C006400510075006500730074003A00330030003000340030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000000C000000000000A506000000000000E0010000140C240C002D31018C00000000000000240C0000012D31014F00000000000000340C140D0100E00C000000000200F40C6C0C940CBC0CBD0B0000020000000000000000D002000000000000C0A8000003000000030000000040004700750069006C006400510075006500730074003A003300300030003500300030003100000040004700750069006C006400510075006500730074003A00330030003000350030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000E00C000000000000A606000000000000E0010000F40C040D002D31018C00000000000000040D0000012D31014F00000000000000140DF80D0100C40D000000000200D80D4C0D760DA00DFA2A0000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0031003100300030003200300030003100000040004700750069006C006400510075006500730074003A003100310030003000320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000C40D000009030000A22F01000000000009000000D80DE80D002D31012C01000000000000E80D0000012D31015800000000000000F80DDC0E0100A80E000000000200BC0E300E5A0E840EFC2A0000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0031003100300030003400300030003100000040004700750069006C006400510075006500730074003A003100310030003000340030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000A80E00005C030000B80B00000000000003000000BC0ECC0E002D31016400000000000000CC0E0000012D31014B00000000000000DC0EC00F01008C0F000000000200A00F140F3E0F680FFD2A0000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0031003100300030003500300030003100000040004700750069006C006400510075006500730074003A003100310030003000350030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000008C0F00005C030000B80B00000000000009000000A00FB00F002D31012C01000000000000B00F0000012D31015800000000000000C00FA410010070100000000002008410F80F22104C10FE2A0000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0031003100300030003600300030003100000040004700750069006C006400510075006500730074003A003100310030003000360030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000701000005C030000B80B0000000000000F00000084109410002D3101F40100000000000094100000012D31016400000000000000A4108811010054110000000002006811DC100611301109520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003100300030003100000040004700750069006C006400510075006500730074003A003200310030003000310030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000054110000FF02000070B60000000000000300000068117811002D3101640000000000000078110000012D31014B0000000000000088116C12010038120000000002004C12C011EA1114120A520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003200300030003100000040004700750069006C006400510075006500730074003A003200310030003000320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000038120000FF02000070B6000000000000090000004C125C12002D31012C010000000000005C120000012D310158000000000000006C12501301001C130000000002003013A412CE12F8120B520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003300300030003100000040004700750069006C006400510075006500730074003A003200310030003000330030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000001C130000FF02000070B60000000000000F00000030134013002D3101F40100000000000040130000012D31016400000000000000501334140100001400000000020014148813B213DC130C520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003400300030003100000040004700750069006C006400510075006500730074003A003200310030003000340030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000000140000D301000070B60000000000000300000014142414002D3101780000000000000024140000012D31014B00000000000000341418150100E414000000000200F8146C149614C0140D520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003500300030003100000040004700750069006C006400510075006500730074003A003200310030003000350030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000E4140000D301000070B600000000000009000000F8140815002D3101680100000000000008150000012D310158000000000000001815FC150100C815000000000200DC1550157A15A4150F520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300030003700300030003100000040004700750069006C006400510075006500730074003A003200310030003000370030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000C8150000AD010000B80B00000000000003000000DC15EC15002D31017800000000000000EC150000012D31014B00000000000000FC15E0160100AC16000000000200C01634165E16881612520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003000300030003100000040004700750069006C006400510075006500730074003A003200310030003100300030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000AC16000001030000672C01000000000003000000C016D016002D31017800000000000000D0160000012D31014B00000000000000E016C41701009017000000000200A417181742176C1713520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003100300030003100000040004700750069006C006400510075006500730074003A003200310030003100310030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000009017000001030000672C01000000000009000000A417B417002D31016801000000000000B4170000012D31015800000000000000C417A818010074180000000002008818FC172618501814520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003200300030003100000040004700750069006C006400510075006500730074003A003200310030003100320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000007418000001030000672C0100000000000F00000088189818002D3101580200000000000098180000012D31016400000000000000A8188C19010058190000000002006C19E0180A19341915520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003300300030003100000040004700750069006C006400510075006500730074003A003200310030003100330030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000005819000000030000B80B000000000000030000006C197C19002D310178000000000000007C190000012D31014B000000000000008C19701A01003C1A000000000200501AC419EE19181A16520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003400300030003100000040004700750069006C006400510075006500730074003A003200310030003100340030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000003C1A000000030000B80B00000000000009000000501A601A002D31016801000000000000601A0000012D31015800000000000000701A541B0100201B000000000200341BA81AD21AFC1A17520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003500300030003100000040004700750069006C006400510075006500730074003A003200310030003100350030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000201B000000030000B80B0000000000000F000000341B441B002D31015802000000000000441B0000012D31016400000000000000541B381C0100041C000000000200181C8C1BB61BE01B18520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003600300030003100000040004700750069006C006400510075006500730074003A003200310030003100360030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000041C000094030000E80300000000000003000000181C281C002D31018C00000000000000281C0000012D31014F00000000000000381C1C1D0100E81C000000000200FC1C701C9A1CC41C1B520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300031003900300030003100000040004700750069006C006400510075006500730074003A003200310030003100390030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000E81C0000D4010000B80B00000000000003000000FC1C0C1D002D31018C000000000000000C1D0000012D31014F000000000000001C1D001E0100CC1D000000000200E01D541D7E1DA81D1C520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003000300030003100000040004700750069006C006400510075006500730074003A003200310030003200300030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000CC1D0000D4010000B80B00000000000009000000E01DF01D002D3101A401000000000000F01D0000012D31015D00000000000000001EE41E0100B01E000000000200C41E381E621E8C1E1D520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003100300030003100000040004700750069006C006400510075006500730074003A003200310030003200310030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000B01E0000D4010000B80B0000000000000F000000C41ED41E002D3101BC02000000000000D41E0000012D31016A00000000000000E41EC81F0100941F000000000200A81F1C1F461F701F1E520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003200300030003100000040004700750069006C006400510075006500730074003A003200310030003200320030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000941F0000C9030000672C01000000000003000000A81FB81F002D31018C00000000000000B81F0000012D31014F00000000000000C81FAC20010078200000000002008C2000202A2054201F520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003300300030003100000040004700750069006C006400510075006500730074003A003200310030003200330030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000078200000C9030000672C010000000000090000008C209C20002D3101A4010000000000009C200000012D31015D00000000000000AC20902101005C210000000002007021E4200E21382122520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003600300030003100000040004700750069006C006400510075006500730074003A003200310030003200360030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000005C21000002030000B80B0000000000000900000070218021002D3101A40100000000000080210000012D31015D0000000000000090217422010040220000000002005422C821F2211C2223520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003700300030003100000040004700750069006C006400510075006500730074003A003200310030003200370030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F0000004022000002030000B80B0000000000000F00000054226422002D3101BC0200000000000064220000012D31016A0000000000000074225823010024230000000002003823AC22D622002324520000000000000000000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003800300030003100000040004700750069006C006400510075006500730074003A003200310030003200380030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000024230000CA030000B80B0000000000000300000038234823002D3101A00000000000000048230000012D3101520000000000000058233C24010008240000000002001C249023BA23E42325520000000000000100000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300032003900300030003100000040004700750069006C006400510075006500730074003A003200310030003200390030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F00000008240000CA030000B80B000000000000090000001C242C24002D3101E0010000000000002C240000012D310161000000000000003C2400000100EC24000000000200002574249E24C82426520000000000000200000000D002000000000000C0A8000001000000010000000040004700750069006C006400510075006500730074003A0032003100300033003000300030003100000040004700750069006C006400510075006500730074003A003200310030003300300030003000320000005200650073007000690072006F002000440065006C00200044007200610067006F000000EC240000CA030000B80B0000000000000F00000000251025002D3101200300000000000010250000012D31016F00000000000000");

//        foreach (var item in guildQuestListParser.AvailableQuestsByZoneID())
//        {
//            var el = SS_ZoneName.Descendants().Where(x => (string)x.Attribute("id") == item.ToString()).FirstOrDefault();
//            if (el != null)
//            {
//                string zoneName = el.Attribute("string").Value;
//                //    Console.WriteLine(" Zone ID: {0} ({1})", item, zoneName);
//            }
//        }
//    }

//    class GuildQuestListParser
//    {
//        const int QUEST_COUNT_OFFSET = 4 * 2;
//        const int FIRST_ADDRESS_OFFSET = 6 * 2;
//        const int GUILD_SIZE_OFFSET = 56 * 2;


//        List<int> addressList = new List<int>();
//        List<string> questStringList = new List<string>();

//        string guildListPacket;
//        public QuestParser questParser;
//        public void ParseGuildListPacket(string p)
//        {
//            questParser = new QuestParser(p);
//            guildListPacket = p;
//            FillQuestStringList();
//        }
//        public List<int> AvailableQuestsByZoneID()
//        {
//            var list = new List<int>();
//            foreach (var item in questStringList)
//            {
//                if (questParser.GetQuestSize(item) == GetGuildSize())
//                {
//                    list.Add(questParser.GetZoneID(item));

//                }
//            }
//            return list;
//        }
//        void FillAddressList()
//        {
//            var firstAddress = StringUtils.Hex2BStringToInt(guildListPacket.Substring(FIRST_ADDRESS_OFFSET));
//            var address = firstAddress * 2;
//            addressList.Add(address);
//            bool end = false;
//            while (!end)
//            {
//                address = StringUtils.Hex2BStringToInt(guildListPacket.Substring(address + 4)) * 2;
//                if (address == 0)
//                {
//                    end = true;
//                }
//                else
//                {
//                    addressList.Add(address);
//                }
//            }
//        }
//        void FillQuestStringList()
//        {
//            FillAddressList();
//            for (int i = 0; i < addressList.Count; i++)
//            {
//                if (i == addressList.Count - 1)
//                {
//                    questStringList.Add(guildListPacket.Substring(addressList[i]));
//                }
//                else
//                {
//                    var start = addressList[i];
//                    var len = addressList[i + 1] - start;
//                    questStringList.Add(guildListPacket.Substring(start, len));
//                }
//                if (questParser.GetQuestID(questStringList[i]) == 11004)
//                {

//                    Console.WriteLine(questStringList[i]);
//                }
//            }
//        }
//        string GetGuildSize()
//        {
//            int size = StringUtils.Hex4BStringToInt(guildListPacket.Substring(GUILD_SIZE_OFFSET));
//            return ((GuildSize)size).ToString();
//        }

//        public class QuestParser
//        {
//            const int QUEST_ID_OFFSET = 22 * 2;
//            const int TARGET_LIST_ADDRESS_OFFSET = 6 * 2;
//            const int TEMPLATE_ID_OFFSET = 8 * 2;
//            const int ZONE_ID_OFFSET = 4 * 2;
//            const int QUEST_SIZE_OFFSET = 30 * 2;

//            string guildListPacket;

//            public int GetQuestID(string q)
//            {
//                int questId = StringUtils.Hex2BStringToInt(q.Substring(QUEST_ID_OFFSET));
//                return questId;
//            }
//            public int GetTemplateID(string q)
//            {
//                int targetsAddress = StringUtils.Hex2BStringToInt(q.Substring(TARGET_LIST_ADDRESS_OFFSET));
//                string targets = guildListPacket.Substring(targetsAddress * 2);

//                return StringUtils.Hex4BStringToInt(targets.Substring(TEMPLATE_ID_OFFSET));

//            }
//            public int GetZoneID(string q)
//            {
//                int targetsAddress = StringUtils.Hex2BStringToInt(q.Substring(TARGET_LIST_ADDRESS_OFFSET));
//                string targets = guildListPacket.Substring(targetsAddress * 2);
//                return StringUtils.Hex4BStringToInt(targets.Substring(ZONE_ID_OFFSET));

//            }
//            public string GetQuestSize(string q)
//            {
//                int size = StringUtils.Hex2BStringToInt(q.Substring(QUEST_SIZE_OFFSET));
//                return ((GuildSize)size).ToString();
//            }

//            public QuestParser(string p)
//            {
//                guildListPacket = p;
//            }

//        }
//    }

//    public enum GuildSize
//    {
//        Small,
//        Medium,
//        Big
//    }




